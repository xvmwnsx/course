{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load custom_filters %}

<link rel="stylesheet" type="text/css" href="{% static 'css/subject_grades.css' %}">

<div class="container">
    <h2 class="page-title">–ñ—É—Ä–Ω–∞–ª –æ—Ü–µ–Ω–æ–∫ - {{ subject.name }}</h2>       

    <table class="grades-table">
        <thead>
            <tr>
                <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                <th>–î–∞—Ç–∞</th>
                <th>–û—Ü–µ–Ω–∫–∞</th>
                <th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
                {% with student_grades=grades_by_date|dict_items %}
                    {% for date, grades_dict in student_grades %}
                        {% with grade_obj=grades_dict|get_item:student.id %}
                        <tr>
                            {% if forloop.first %}
                                <td rowspan="{{ student_grades|length }}">{{ student.last_name }} {{ student.first_name }}</td>
                            {% endif %}
                            <td>{{ date }}</td>
                            <td class="grade-cell 
                                {% if grade_obj and grade_obj.value == '5' or grade_obj.value == '4' %}green
                                {% elif grade_obj and grade_obj.value == '3' %}yellow
                                {% elif grade_obj and grade_obj.value == '2' or grade_obj.value == 'fail' %}red
                                {% elif grade_obj and grade_obj.value == 'pass' %}pass
                                {% endif %}">
                                {{ grade_obj.value }}
                            </td>
                            <td>
                                {% if grade_obj and grade_obj.id %}
                                    <a href="{% url 'grade_edit' pk=grade_obj.id %}">‚úèÔ∏è</a>
                                {% else %}
                                    ‚Äî
                                {% endif %}
                            </td>  
                        </tr>
                        {% endwith %}
                    {% endfor %}
                {% endwith %}
            {% empty %}
                <tr>
                    <td colspan="4" class="no-data">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="buttons">
        <a href="{% url 'grade_list' %}" class="btn">‚¨Ö –ù–∞–∑–∞–¥</a>
        <a href="{% url 'generate_subject_pdf' subject.id %}" class="btn_download-btn">üìÑ –°–∫–∞—á–∞—Ç—å PDF</a>
    </div>
</div>
{% endblock %}
